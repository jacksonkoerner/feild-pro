<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Section Editor - FieldVoice Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes pulse-recording {
            0%, 100% { opacity: 0.1; }
            50% { opacity: 0.3; }
        }
        .animate-pulse-recording { animation: pulse-recording 1.5s ease-in-out infinite; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen">
    <div id="app" class="max-w-2xl mx-auto h-screen flex flex-col">
        <!-- HEADER -->
        <header class="p-4 flex items-center gap-4 bg-white border-b sticky top-0 z-10">
            <a href="index.html" class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-50 transition-colors">
                <i class="fas fa-arrow-left text-slate-400"></i>
            </a>
            <h1 id="sectionTitle" class="text-lg font-black text-slate-800 flex-1"></h1>
        </header>

        <main class="flex-1 overflow-y-auto p-4 space-y-6 pb-40">
            <!-- EXAMPLES SECTION -->
            <section class="bg-white rounded-3xl p-6 border border-slate-200 shadow-sm">
                <div class="flex items-center gap-2 mb-4">
                    <div class="w-8 h-8 bg-indigo-50 rounded-lg flex items-center justify-center text-indigo-600">
                        <i class="fas fa-lightbulb text-xs"></i>
                    </div>
                    <h2 class="text-xs font-black text-slate-400 uppercase tracking-widest">What to say</h2>
                </div>
                <div id="examplesContainer" class="space-y-3"></div>
            </section>

            <!-- DRAFTED DATA SECTION -->
            <section class="space-y-4">
                <h3 class="text-[10px] font-black uppercase tracking-widest text-slate-400 ml-2">Drafted Data</h3>
                <div id="draftedDataContainer" class="bg-white rounded-3xl border border-slate-200 p-2 shadow-sm overflow-hidden"></div>
            </section>
        </main>

        <!-- VOICE INPUT BAR -->
        <div class="fixed bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-slate-50 via-slate-50 to-transparent">
            <div class="max-w-2xl mx-auto">
                <div id="voiceInputBar" class="flex items-center gap-3 bg-slate-900 text-white p-2 pl-6 rounded-full shadow-2xl transition-all h-16 relative overflow-hidden ring-4 ring-white">
                    <div id="recordingPulse" class="hidden absolute inset-0 bg-red-600 animate-pulse-recording pointer-events-none"></div>
                    <div class="flex-1 min-w-0 relative z-10">
                        <p id="voiceStatus" class="text-xs font-black uppercase tracking-widest text-indigo-400 mb-0.5">Voice Assistant</p>
                        <div id="voiceTranscript" class="truncate text-sm font-medium text-slate-300 italic pr-4">Tap mic to start field notes</div>
                    </div>
                    <button id="micButton" type="button" class="w-12 h-12 rounded-full flex items-center justify-center text-white text-xl shadow-lg transition-all active:scale-90 bg-indigo-600 hover:bg-indigo-700 relative z-10">
                        <i id="micIcon" class="fas fa-microphone"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // ============ GEMINI API KEY - PUT YOUR KEY HERE FOR TESTING ============
        const GEMINI_API_KEY = 'YOUR_GEMINI_API_KEY_HERE';

        // ============ SECTIONS CONFIG ============
        const SECTIONS = {
            overview: { title: 'Site Conditions', icon: 'fa-cloud-sun', prompt: 'How is the site looking today?', examples: ["The site is very muddy after last night's rain.", "High of 85, sunny, working conditions are ideal.", "Surface is dry and ready for paving."] },
            activities: { title: 'Work Summary', icon: 'fa-tasks', prompt: 'What was accomplished today?', examples: ["Boh Bros started clearing the North basin.", "HGBM finished the culvert installation at Station 12.", "Electrical sub is running conduit for site lighting."] },
            operations: { title: 'Headcounts', icon: 'fa-users', prompt: 'Who is on site today?', examples: ["HGBM has 1 super, 2 foremen, and 12 laborers.", "Metro Plumbing has 4 journeymen on site.", "Survey crew is here with 3 people."] },
            equipment: { title: 'Equipment', icon: 'fa-truck-pickup', prompt: 'What machines are moving?', examples: ["Two Cat 320 excavators active all day.", "D6 Dozer arrived at 9 AM.", "Roller is currently idle near the south gate."] },
            issues: { title: 'Delays & Issues', icon: 'fa-exclamation-triangle', prompt: 'Any problems or unforeseen events?', examples: ["Waiting on RFI #22 for structural steel.", "Utility strike at 2 PM, resolved by 4 PM.", "Concrete delivery was 2 hours late."] },
            qaqc: { title: 'Inspections', icon: 'fa-check-double', prompt: 'What was tested or inspected?', examples: ["Performed slump test on Load #4.", "Proof roll passed on subgrade segment B.", "Checked reinforcement at pier 4."] },
            safety: { title: 'Safety & Incidents', icon: 'fa-hard-hat', prompt: 'Everything safe on site?', examples: ["Conducted toolbox talk on trench safety.", "All workers using proper PPE.", "Minor trip hazard identified and cleared."] },
            photos: { title: 'Progress Photos', icon: 'fa-camera', prompt: 'Any visual progress to note?', examples: ["Taking photos of the new curb line.", "Documented the utility repair.", "Photo of the completed drainage structure."] },
        };

        // ============ STATE ============
        let currentSection = 'activities';
        let isRecording = false;
        let isProcessing = false;
        let recognition = null;
        let currentTranscript = '';

        // ============ STATE MANAGEMENT ============
        function getReport() {
            const saved = localStorage.getItem('fieldvoice_report');
            if (saved) {
                try {
                    return JSON.parse(saved);
                } catch (e) {
                    return getInitialReport();
                }
            }
            return getInitialReport();
        }

        function getInitialReport() {
            return {
                overview: {
                    projectName: "North-South Connector Road Phase 2",
                    noabProjectNo: "1291",
                    cnoSolicitationNo: "N/A",
                    noticeToProceed: "June 27th, 2025",
                    contractDuration: "467 days",
                    expectedCompletion: "October 7th, 2026",
                    contractDayNo: "19 of 467 days",
                    weatherDays: "0 days",
                    date: new Date().toLocaleDateString(),
                    location: "Louis Armstrong New Orleans Int'l Airport",
                    engineer: "Garver, LLC",
                    contractor: "Hunt, Gibbs, Boh, & Metro (HGBM)",
                    startTime: "6:00 AM",
                    endTime: "4:00 PM",
                    shiftDuration: "10.00 hours",
                    completedBy: "Inspector Name, RPR",
                    weather: {
                        highTemp: "--",
                        lowTemp: "--",
                        precipitation: "0.00\"",
                        generalCondition: "Syncing...",
                        jobSiteCondition: "Dry",
                        adverseConditions: "N/A",
                    },
                },
                activities: [],
                operations: [],
                equipment: [],
                generalIssues: [],
                communications: [],
                qaqcNotes: [],
                safety: { hasIncidents: false, notes: [] },
                visitorsRemarks: [],
                photos: [],
            };
        }

        function saveReport(report) {
            localStorage.setItem('fieldvoice_report', JSON.stringify(report));
        }

        // ============ GEMINI AI PROCESSING ============
        async function processWithGemini(transcript, section) {
            const report = getReport();

            const systemInstruction = `
                You are an expert construction reporting assistant. Your job is to extract data from a field user's spoken transcript
                and map it into the specific fields of an RPR Daily Report.

                CRITICAL RULES:
                1. Only update the fields mentioned in the transcript.
                2. Maintain contractor consistency. If a contractor is mentioned, use their standard name (e.g., BOH BROS, HGBM).
                3. If the user says "No work performed", set the narrative for that contractor accordingly.
                4. For numerical headcounts or equipment quantities, extract the exact number.
                5. For "operations" (headcounts), map titles like 'Superintendent' to 'supers', 'Foreman' to 'foreman', etc.
                6. Return ONLY valid JSON that matches the provided schema.
            `;

            const prompt = `
                CURRENT SECTION CONTEXT: ${section}
                TRANSCRIPT: "${transcript}"

                EXISTING REPORT STATE (for context, do not duplicate data unnecessarily):
                ${JSON.stringify(report)}

                Map the transcript to the schema. If information is missing for a field, omit that field from the output.

                Return JSON with these possible fields (only include what's relevant):
                - overview: { weather: { highTemp, lowTemp, precipitation, generalCondition, jobSiteCondition, adverseConditions } }
                - activities: [{ contractor, trade, narrative, equipmentSummary, crewSummary }]
                - operations: [{ contractor, trade, supers, foreman, operators, laborers, surveyors, others }]
                - equipment: [{ contractor, model, quantity, notes }]
                - generalIssues: ["string"]
                - communications: ["string"]
                - qaqcNotes: ["string"]
                - safety: { hasIncidents: boolean, notes: ["string"] }
                - visitorsRemarks: ["string"]
            `;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: systemInstruction + '\n\n' + prompt }] }],
                        generationConfig: {
                            responseMimeType: "application/json"
                        }
                    })
                });

                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '{}';
                return JSON.parse(text);
            } catch (error) {
                console.error("Gemini API Error:", error);
                return {};
            }
        }

        function updateReport(newData) {
            const report = getReport();

            // Merge overview
            if (newData.overview) {
                report.overview = { ...report.overview, ...newData.overview };
                if (newData.overview.weather) {
                    report.overview.weather = { ...report.overview.weather, ...newData.overview.weather };
                }
            }

            // Merge arrays (append new items)
            if (newData.activities && newData.activities.length > 0) {
                report.activities = [...report.activities, ...newData.activities];
            }
            if (newData.operations && newData.operations.length > 0) {
                report.operations = [...report.operations, ...newData.operations];
            }
            if (newData.equipment && newData.equipment.length > 0) {
                report.equipment = [...report.equipment, ...newData.equipment];
            }
            if (newData.generalIssues && newData.generalIssues.length > 0) {
                report.generalIssues = [...report.generalIssues, ...newData.generalIssues];
            }
            if (newData.communications && newData.communications.length > 0) {
                report.communications = [...report.communications, ...newData.communications];
            }
            if (newData.qaqcNotes && newData.qaqcNotes.length > 0) {
                report.qaqcNotes = [...report.qaqcNotes, ...newData.qaqcNotes];
            }
            if (newData.safety) {
                report.safety = { ...report.safety, ...newData.safety };
                if (newData.safety.notes) {
                    report.safety.notes = [...(report.safety.notes || []), ...newData.safety.notes];
                }
            }
            if (newData.visitorsRemarks && newData.visitorsRemarks.length > 0) {
                report.visitorsRemarks = [...report.visitorsRemarks, ...newData.visitorsRemarks];
            }

            saveReport(report);
            renderDraftedData();
        }

        // ============ VOICE INPUT ============
        function startRecording() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                alert("Speech Recognition not supported in this browser. Try Chrome.");
                return;
            }

            currentTranscript = '';
            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onstart = () => {
                isRecording = true;
                updateVoiceUI();
            };

            recognition.onresult = (event) => {
                let transcript = '';
                for (let i = 0; i < event.results.length; i++) {
                    transcript += event.results[i][0].transcript;
                }
                currentTranscript = transcript;
                document.getElementById('voiceTranscript').textContent = transcript || 'Describe the work...';
            };

            recognition.onend = () => {
                isRecording = false;
                updateVoiceUI();
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                isRecording = false;
                updateVoiceUI();
            };

            recognition.start();
        }

        async function stopRecording() {
            if (recognition) {
                recognition.stop();
                recognition = null;
                isRecording = false;

                const finalTranscript = currentTranscript.trim();
                if (finalTranscript) {
                    isProcessing = true;
                    updateVoiceUI();

                    const result = await processWithGemini(finalTranscript, currentSection);
                    updateReport(result);

                    isProcessing = false;
                    currentTranscript = '';
                    updateVoiceUI();
                }
            }
        }

        function updateVoiceUI() {
            const micButton = document.getElementById('micButton');
            const micIcon = document.getElementById('micIcon');
            const voiceStatus = document.getElementById('voiceStatus');
            const voiceTranscript = document.getElementById('voiceTranscript');
            const recordingPulse = document.getElementById('recordingPulse');

            if (isProcessing) {
                micButton.className = 'w-12 h-12 rounded-full flex items-center justify-center text-white text-xl shadow-lg transition-all bg-indigo-600 opacity-50 cursor-not-allowed relative z-10';
                micIcon.className = 'fas fa-spinner fa-spin text-sm';
                voiceStatus.textContent = 'AI Mapping...';
                voiceTranscript.textContent = 'Organizing notes...';
                recordingPulse.classList.add('hidden');
            } else if (isRecording) {
                micButton.className = 'w-12 h-12 rounded-full flex items-center justify-center text-white text-xl shadow-lg transition-all active:scale-90 bg-red-500 hover:bg-red-600 relative z-10';
                micIcon.className = 'fas fa-stop';
                voiceStatus.textContent = 'Listening Now...';
                recordingPulse.classList.remove('hidden');
            } else {
                micButton.className = 'w-12 h-12 rounded-full flex items-center justify-center text-white text-xl shadow-lg transition-all active:scale-90 bg-indigo-600 hover:bg-indigo-700 relative z-10';
                micIcon.className = 'fas fa-microphone';
                voiceStatus.textContent = 'Voice Assistant';
                voiceTranscript.textContent = 'Tap mic to start field notes';
                recordingPulse.classList.add('hidden');
            }
        }

        // ============ RENDER FUNCTIONS ============
        function renderExamples() {
            const config = SECTIONS[currentSection];
            const container = document.getElementById('examplesContainer');
            container.innerHTML = config.examples.map(ex => `
                <div class="flex gap-3 items-start group">
                    <div class="mt-1 w-1.5 h-1.5 rounded-full bg-indigo-300 group-hover:bg-indigo-500 transition-colors"></div>
                    <p class="text-sm text-slate-600 italic">"${ex}"</p>
                </div>
            `).join('');
        }

        function renderDraftedData() {
            const report = getReport();
            const container = document.getElementById('draftedDataContainer');

            switch (currentSection) {
                case 'overview':
                    container.innerHTML = `
                        <div class="p-4 space-y-4">
                            ${Object.entries(report.overview.weather).map(([key, value]) => `
                                <div>
                                    <label class="block text-[10px] font-black text-slate-400 uppercase mb-1 ml-1">
                                        ${key.replace(/([A-Z])/g, ' $1')}
                                    </label>
                                    <input
                                        class="w-full p-3 bg-slate-50 border border-slate-100 rounded-2xl text-sm font-medium focus:ring-2 focus:ring-indigo-500 outline-none transition-all"
                                        value="${value}"
                                        data-weather-key="${key}"
                                    />
                                </div>
                            `).join('')}
                        </div>
                    `;
                    // Add event listeners for weather inputs
                    container.querySelectorAll('input[data-weather-key]').forEach(input => {
                        input.addEventListener('change', (e) => {
                            const key = e.target.dataset.weatherKey;
                            const report = getReport();
                            report.overview.weather[key] = e.target.value;
                            saveReport(report);
                        });
                    });
                    break;

                case 'activities':
                    container.innerHTML = `
                        <div class="p-2 space-y-2">
                            ${report.activities.map((act, i) => `
                                <div class="p-4 bg-slate-50 rounded-2xl border border-slate-100">
                                    <div class="flex justify-between items-center mb-2">
                                        <div class="font-bold text-slate-800 text-sm uppercase tracking-tight">${act.contractor}</div>
                                        <div class="text-[10px] font-bold text-slate-400">${act.trade}</div>
                                    </div>
                                    <textarea
                                        class="w-full p-3 bg-white border border-slate-100 rounded-xl text-sm outline-none focus:ring-1 focus:ring-indigo-200"
                                        rows="3"
                                        data-activity-index="${i}"
                                    >${act.narrative}</textarea>
                                </div>
                            `).join('')}
                            <button id="addContractorBtn" class="w-full py-4 border-2 border-dashed border-slate-100 rounded-2xl text-slate-400 font-bold text-xs hover:bg-slate-50 transition-colors uppercase tracking-widest">
                                + Add Contractor Row
                            </button>
                        </div>
                    `;
                    // Add event listeners
                    container.querySelectorAll('textarea[data-activity-index]').forEach(textarea => {
                        textarea.addEventListener('change', (e) => {
                            const idx = parseInt(e.target.dataset.activityIndex);
                            const report = getReport();
                            report.activities[idx].narrative = e.target.value;
                            saveReport(report);
                        });
                    });
                    document.getElementById('addContractorBtn')?.addEventListener('click', () => {
                        const report = getReport();
                        report.activities.push({ contractor: "NEW CONTRACTOR", trade: "TRADE", narrative: "", equipmentSummary: "", crewSummary: "" });
                        saveReport(report);
                        renderDraftedData();
                    });
                    break;

                case 'operations':
                    container.innerHTML = `
                        <div class="overflow-x-auto p-2">
                            <table class="w-full text-[10px] text-left border-collapse">
                                <thead>
                                    <tr class="text-slate-400 font-black uppercase tracking-widest">
                                        <th class="p-3">Contractor</th>
                                        <th class="p-3 text-center">Super</th>
                                        <th class="p-3 text-center">Fm</th>
                                        <th class="p-3 text-center">Op</th>
                                        <th class="p-3 text-center">Lab</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-100">
                                    ${report.operations.length > 0 ? report.operations.map((row, i) => `
                                        <tr>
                                            <td class="p-3 font-bold text-slate-700">${row.contractor}</td>
                                            <td class="p-3"><input class="w-10 p-1 bg-slate-50 rounded text-center" value="${row.supers || ''}" data-op-index="${i}" data-op-field="supers" /></td>
                                            <td class="p-3"><input class="w-10 p-1 bg-slate-50 rounded text-center" value="${row.foreman || ''}" data-op-index="${i}" data-op-field="foreman" /></td>
                                            <td class="p-3"><input class="w-10 p-1 bg-slate-50 rounded text-center" value="${row.operators || ''}" data-op-index="${i}" data-op-field="operators" /></td>
                                            <td class="p-3"><input class="w-10 p-1 bg-slate-50 rounded text-center" value="${row.laborers || ''}" data-op-index="${i}" data-op-field="laborers" /></td>
                                        </tr>
                                    `).join('') : `
                                        <tr>
                                            <td colspan="5" class="p-8 text-center text-slate-300 italic">No headcounts recorded yet.</td>
                                        </tr>
                                    `}
                                </tbody>
                            </table>
                        </div>
                    `;
                    // Add event listeners for operations
                    container.querySelectorAll('input[data-op-index]').forEach(input => {
                        input.addEventListener('change', (e) => {
                            const idx = parseInt(e.target.dataset.opIndex);
                            const field = e.target.dataset.opField;
                            const report = getReport();
                            report.operations[idx][field] = e.target.value;
                            saveReport(report);
                        });
                    });
                    break;

                case 'photos':
                    container.innerHTML = `
                        <div class="p-4 space-y-4">
                            <label class="block w-full text-center py-8 border-2 border-dashed border-slate-200 rounded-3xl cursor-pointer hover:bg-slate-50 transition-colors">
                                <input type="file" accept="image/*" multiple class="hidden" id="photoInput" />
                                <i class="fas fa-plus text-slate-300 text-2xl mb-2"></i>
                                <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">Add Site Photos</p>
                            </label>
                            <div class="grid grid-cols-2 gap-3">
                                ${report.photos.map((p, idx) => `
                                    <div class="bg-slate-50 p-2 rounded-2xl border border-slate-100">
                                        <img src="${p.url}" class="w-full aspect-square object-cover rounded-xl mb-2" />
                                        <textarea
                                            placeholder="Caption..."
                                            class="w-full p-2 bg-white border border-slate-100 rounded-lg text-[10px] outline-none"
                                            rows="2"
                                            data-photo-index="${idx}"
                                        >${p.caption}</textarea>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    // Photo input handler
                    document.getElementById('photoInput')?.addEventListener('change', (e) => {
                        const files = e.target.files;
                        if (!files) return;
                        const report = getReport();
                        Array.from(files).forEach((f) => {
                            const reader = new FileReader();
                            reader.onload = (ev) => {
                                report.photos.push({
                                    id: Math.random().toString(),
                                    url: ev.target.result,
                                    caption: "",
                                    date: new Date().toLocaleDateString()
                                });
                                saveReport(report);
                                renderDraftedData();
                            };
                            reader.readAsDataURL(f);
                        });
                    });
                    // Caption handlers
                    container.querySelectorAll('textarea[data-photo-index]').forEach(textarea => {
                        textarea.addEventListener('change', (e) => {
                            const idx = parseInt(e.target.dataset.photoIndex);
                            const report = getReport();
                            report.photos[idx].caption = e.target.value;
                            saveReport(report);
                        });
                    });
                    break;

                case 'equipment':
                    container.innerHTML = `
                        <div class="overflow-x-auto p-2">
                            <table class="w-full text-[10px] text-left border-collapse">
                                <thead>
                                    <tr class="text-slate-400 font-black uppercase tracking-widest">
                                        <th class="p-3">Contractor</th>
                                        <th class="p-3">Model</th>
                                        <th class="p-3 text-center">Qty</th>
                                        <th class="p-3">Notes</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-100">
                                    ${report.equipment.length > 0 ? report.equipment.map((row, i) => `
                                        <tr>
                                            <td class="p-3 font-bold text-slate-700">${row.contractor}</td>
                                            <td class="p-3">${row.model}</td>
                                            <td class="p-3 text-center">${row.quantity}</td>
                                            <td class="p-3">${row.notes || ''}</td>
                                        </tr>
                                    `).join('') : `
                                        <tr>
                                            <td colspan="4" class="p-8 text-center text-slate-300 italic">No equipment recorded yet.</td>
                                        </tr>
                                    `}
                                </tbody>
                            </table>
                        </div>
                    `;
                    break;

                case 'issues':
                    container.innerHTML = `
                        <div class="p-4 space-y-2">
                            ${report.generalIssues.length > 0 ? report.generalIssues.map((issue, i) => `
                                <div class="p-3 bg-slate-50 rounded-xl border border-slate-100 text-sm">${issue}</div>
                            `).join('') : '<div class="p-12 text-center text-slate-300 italic">Ready for voice input...</div>'}
                        </div>
                    `;
                    break;

                case 'qaqc':
                    container.innerHTML = `
                        <div class="p-4 space-y-2">
                            ${report.qaqcNotes.length > 0 ? report.qaqcNotes.map((note, i) => `
                                <div class="p-3 bg-slate-50 rounded-xl border border-slate-100 text-sm">${note}</div>
                            `).join('') : '<div class="p-12 text-center text-slate-300 italic">Ready for voice input...</div>'}
                        </div>
                    `;
                    break;

                case 'safety':
                    container.innerHTML = `
                        <div class="p-4 space-y-2">
                            <div class="flex items-center gap-2 mb-4">
                                <span class="text-sm font-bold ${report.safety.hasIncidents ? 'text-red-600' : 'text-green-600'}">
                                    ${report.safety.hasIncidents ? 'Incidents Reported' : 'No Incidents'}
                                </span>
                            </div>
                            ${report.safety.notes.length > 0 ? report.safety.notes.map((note, i) => `
                                <div class="p-3 bg-slate-50 rounded-xl border border-slate-100 text-sm">${note}</div>
                            `).join('') : '<div class="p-8 text-center text-slate-300 italic">Ready for voice input...</div>'}
                        </div>
                    `;
                    break;

                default:
                    container.innerHTML = '<div class="p-12 text-center text-slate-300 italic">Ready for voice input...</div>';
            }
        }

        // ============ INIT ============
        document.addEventListener('DOMContentLoaded', () => {
            // Get section from URL
            const params = new URLSearchParams(window.location.search);
            currentSection = params.get('section') || 'activities';

            if (!SECTIONS[currentSection]) {
                currentSection = 'activities';
            }

            // Update title
            document.getElementById('sectionTitle').textContent = SECTIONS[currentSection].title;

            // Render examples and data
            renderExamples();
            renderDraftedData();

            // Mic button handler
            document.getElementById('micButton').addEventListener('click', (e) => {
                e.preventDefault();
                if (isProcessing) return;

                if (isRecording) {
                    stopRecording();
                } else {
                    startRecording();
                }
            });
        });
    </script>
</body>
</html>
